<h1>AIVIO CRM</h1>

<button onclick="loadLeads()">Frissítés</button>

<table border="1" cellpadding="6">
  <thead>
    <tr>
      <th>Név</th>
      <th>Email</th>
      <th>Telefon</th>
      <th>Státusz</th>
    </tr>
  </thead>
  <tbody id="leads"></tbody>
</table>

<hr>

<h2>Új lead rögzítése</h2>

<input id="name" placeholder="Név"><br><br>
<input id="email" placeholder="Email"><br><br>
<input id="phone" placeholder="Telefon"><br><br>
<textarea id="note" placeholder="Megjegyzés"></textarea><br><br>

<button onclick="createLead()">Mentés</button>

<script>
async function loadLeads() {
  const res = await fetch("/api/crm/leads");
  const leads = await res.json();

  const tbody = document.getElementById("leads");
  tbody.innerHTML = "";

  leads.forEach(l => {
    tbody.innerHTML += `
      <tr>
        <td>${l.name}</td>
        <td>${l.email_from || ""}</td>
        <td>${l.phone || ""}</td>
        <td>${l.stage_id ? l.stage_id[1] : ""}</td>
      </tr>
    `;
  });
}

async function createLead() {
  const data = {
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    phone: document.getElementById("phone").value,
    note: document.getElementById("note").value
  };

  const res = await fetch("/api/crm/create-lead", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const result = await res.json();

  if (result.success) {
    alert("Lead rögzítve (#" + result.leadId + ")");
    loadLeads();
  } else {
    alert("Hiba történt.");
  }
}

loadLeads();
</script>
