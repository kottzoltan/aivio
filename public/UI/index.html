<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AIVIO ‚Äì AI √ºgyn√∂k dem√≥</title>

  <style>
    body {
      margin: 0;
      padding: 40px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, Segoe UI;
      background: #0f172a;
      color: #e5e7eb;
    }

    h1 {
      margin-bottom: 8px;
      font-size: 36px;
    }

    p {
      opacity: 0.8;
      margin-bottom: 28px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .card {
      background: #111827;
      border-radius: 16px;
      padding: 16px;
      cursor: pointer;
      transition: transform .15s ease, box-shadow .15s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.4);
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0,0,0,.6);
    }

    .card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .card h3 {
      margin: 0 0 6px 0;
      font-size: 18px;
    }

    .card span {
      font-size: 14px;
      opacity: .7;
    }

    #controls {
      margin-top: 24px;
    }

    button {
      background: #2563eb;
      border: none;
      color: white;
      padding: 14px 22px;
      font-size: 16px;
      border-radius: 12px;
      cursor: pointer;
      margin-right: 12px;
    }

    button:disabled {
      opacity: .5;
      cursor: not-allowed;
    }

    #status {
      margin-top: 16px;
      font-size: 14px;
      opacity: .85;
    }
  </style>
</head>

<body>

  <h1>AIVIO ‚Äì AI √ºgyn√∂k dem√≥</h1>
  <p>Kattints egy √ºgyn√∂kre, majd besz√©lj hozz√° mikrofonon.</p>

  <div class="grid">
    <div class="card" onclick="selectAgent('Kimen≈ë telefonos sales √ºgyn√∂k')">
      <img src="/img/outbound-phone.jpg">
      <h3>Kimen≈ë telefonos sales</h3>
      <span>Telefonos √©rt√©kes√≠t√©s</span>
    </div>

    <div class="card" onclick="selectAgent('Kimen≈ë email sales √ºgyn√∂k')">
      <img src="/img/outbound-email.jpg">
      <h3>Email sales</h3>
      <span>Email kamp√°nyok</span>
    </div>

    <div class="card" onclick="selectAgent('Bej√∂v≈ë √ºgyf√©lszolg√°lati robot')">
      <img src="/img/inbound-support.jpg">
      <h3>Bej√∂v≈ë √ºgyf√©lszolg√°lat</h3>
      <span>Telefonos t√°mogat√°s</span>
    </div>

    <div class="card" onclick="selectAgent('Adatbek√©r≈ë √©s visszah√≠v√≥ robot')">
      <img src="/img/data-collection.jpg">
      <h3>Adatbek√©r≈ë robot</h3>
      <span>Visszah√≠v√°ssal</span>
    </div>
  </div>

  <div id="controls">
    <button id="micBtn">üé§ Besz√©lj AIVIO-val</button>
  </div>

  <div id="status">Nincs kiv√°lasztott √ºgyn√∂k.</div>

<script>
let currentAgent = null;
let recognition;
let listening = false;

function selectAgent(agentName) {
  currentAgent = agentName;
  document.getElementById("status").innerText =
    "‚úÖ Kiv√°lasztva: " + agentName + ". Nyomd meg a üé§ gombot!";
}

document.getElementById("micBtn").onclick = () => {
  if (!currentAgent) {
    alert("El≈ësz√∂r v√°lassz egy √ºgyn√∂k√∂t!");
    return;
  }
  startListening();
};

function startListening() {
  if (!("webkitSpeechRecognition" in window)) {
    alert("A b√∂ng√©sz≈ëd nem t√°mogatja a besz√©dfelismer√©st. Chrome aj√°nlott.");
    return;
  }

  recognition = new webkitSpeechRecognition();
  recognition.lang = "hu-HU";
  recognition.interimResults = false;
  recognition.continuous = false;

  recognition.onstart = () => {
    listening = true;
    document.getElementById("status").innerText =
      "üéß Figyelek (" + currentAgent + ") ‚Äì besz√©lj!";
  };

  recognition.onresult = async (event) => {
    const spokenText = event.results[0][0].transcript;

    document.getElementById("status").innerText =
      "üó£Ô∏è Te: " + spokenText;

    // AI k√©rd√©s
    const aiRes = await fetch("/ai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: currentAgent + ": " + spokenText
      })
    });

    const aiData = await aiRes.json();

    // Besz√©d
    const speakRes = await fetch("/speak", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text: aiData.reply
      })
    });

    const audioBlob = await speakRes.blob();
    const audio = new Audio(URL.createObjectURL(audioBlob));
    audio.play();

    document.getElementById("status").innerText =
      "‚ñ∂Ô∏è AIVIO v√°laszol‚Ä¶";
  };

  recognition.onerror = (e) => {
    document.getElementById("status").innerText =
      "‚ùå Hiba: " + e.error;
  };

  recognition.onend = () => {
    listening = false;
  };

  recognition.start();
}
</script>

</body>
</html>
